<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake Game</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: #111;
        color: #fff;
    }

    h1 {
        text-align: center;
    }

    #gameContainer {
        position: relative;
    }

    canvas {
        background: #222;
        display: block;
        margin: 20px auto;
        border: 4px solid #06b6d4;
        border-radius: 10px;
    }

    .popup {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background: rgba(0,0,0,0.9);
        padding: 40px 60px;
        border-radius: 15px;
        text-align: center;
        font-size: 24px;
        color: #fff;
        animation: popupAnim 0.5s forwards;
        z-index: 10;
        user-select: none;
    }

    @keyframes popupAnim {
        to {
            transform: translate(-50%, -50%) scale(1);
        }
    }

    .settings {
        margin-bottom: 20px;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .settings select, .settings button {
        padding: 10px;
        font-size: 16px;
        border-radius: 5px;
        border: none;
        outline: none;
        cursor: pointer;
    }

    .scoreboard {
        text-align: center;
        font-size: 18px;
    }

    /* Modal overlay for user permission */
    #permissionModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.85);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #fff;
        font-size: 24px;
        z-index: 100;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    #permissionModal.show {
        visibility: visible;
        opacity: 1;
    }

    #permissionModal button {
        margin-top: 20px;
        padding: 12px 30px;
        font-size: 20px;
        border: none;
        border-radius: 8px;
        background: #06b6d4;
        color: #fff;
        cursor: pointer;
        user-select: none;
    }
</style>
</head>
<body>
<h1>Snake Game</h1>

<div class="settings">
    <select id="speedSelect">
        <option value="5">Low Speed</option>
        <option value="10" selected>Medium Speed</option>
        <option value="15">High Speed</option>
    </select>

    <select id="colorSelect">
        <option value="red" selected>Red</option>
        <option value="blue">Blue</option>
        <option value="green">Green</option>
        <option value="yellow">Yellow</option>
        <option value="orange">Orange</option>
    </select>

    <button id="startBtn">Start Game</button>
    <button id="pauseBtn" disabled>Pause</button>
</div>

<div class="scoreboard">
    Score: <span id="score">0</span> | High Score: <span id="highScore">0</span>
</div>

<div id="gameContainer">
    <canvas id="gameCanvas" width="500" height="500"></canvas>
</div>

<!-- Permission Modal -->
<div id="permissionModal">
    <div>Do you want to start the game?</div>
    <button id="confirmStartBtn">Start</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const speedSelect = document.getElementById('speedSelect');
const colorSelect = document.getElementById('colorSelect');
const scoreEl = document.getElementById('score');
const highScoreEl = document.getElementById('highScore');
const permissionModal = document.getElementById('permissionModal');
const confirmStartBtn = document.getElementById('confirmStartBtn');

let snake = [];
let direction = 'RIGHT';
let food = {};
let speed = 10;
let snakeColor = 'red';
let score = 0;
let highScore = 0;
let gameInterval;
const gridSize = 20;
let canChangeDirection = true;
let isPaused = false;
let gameInitialized = false; // Track if game is initialized

// Preload apple image
const appleImg = new Image();
appleImg.src = 'https://img.icons8.com/emoji/48/000000/red-apple.png';

// Load sound effects
const eatSound = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
// Bell ringing sound for game over
const gameOverSound = new Audio('https://actions.google.com/sounds/v1/alarms/bell_ring.ogg');

// Event listener for arrow keys and pause toggle via keyboard
document.addEventListener('keydown', (e) => {
    if (!canChangeDirection) return;

    if (e.key === 'ArrowUp' && direction !== 'DOWN') direction = 'UP';
    else if (e.key === 'ArrowDown' && direction !== 'UP') direction = 'DOWN';
    else if (e.key === 'ArrowLeft' && direction !== 'RIGHT') direction = 'LEFT';
    else if (e.key === 'ArrowRight' && direction !== 'LEFT') direction = 'RIGHT';

    canChangeDirection = false;

    // Pause toggle with 'P' key
    if (e.key === 'p' || e.key === 'P') {
        togglePause();
    }
});

// When user clicks main Start Game button
startBtn.addEventListener('click', () => {
    if (!gameInitialized) {
        // Show permission modal first
        speed = parseInt(speedSelect.value);
        snakeColor = colorSelect.value;
        showPermissionModal();
    } else if (isPaused) {
        // If game initialized but paused, resume game
        togglePause();
    } else {
        // Start the game loop if not running
        startGameLoop();
    }
});

// Pause button
pauseBtn.addEventListener('click', () => {
    togglePause();
});

// Confirm start button in modal
confirmStartBtn.addEventListener('click', () => {
    hidePermissionModal();
    initializeGame();
});

// Show permission modal
function showPermissionModal() {
    permissionModal.classList.add('show');
}

// Hide permission modal
function hidePermissionModal() {
    permissionModal.classList.remove('show');
}

// Initialize snake and food but do NOT start game loop
function initializeGame() {
    clearInterval(gameInterval);
    snake = [{x: 200, y: 200}];
    direction = 'RIGHT';
    spawnFood();
    score = 0;
    scoreEl.textContent = score;
    isPaused = true; // Start paused
    pauseBtn.textContent = 'Pause';
    pauseBtn.disabled = false;
    gameInitialized = true;
    showPopup('Game Ready! Click Start to Play', 1500);
}

// Start the game loop (called after initialization)
function startGameLoop() {
    if (!gameInitialized) return;
    if (!isPaused) return; // Already running

    isPaused = false;
    pauseBtn.textContent = 'Pause';
    gameInterval = setInterval(gameLoop, 1000 / speed);
    showPopup('Game Started!', 800);
}

// Game loop
function gameLoop() {
    if (isPaused) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    moveSnake();
    checkCollision();
    drawSnake();
    drawFood();
    canChangeDirection = true;
}

// Move snake
function moveSnake() {
    let head = {...snake[0]};
    if(direction === 'UP') head.y -= gridSize;
    if(direction === 'DOWN') head.y += gridSize;
    if(direction === 'LEFT') head.x -= gridSize;
    if(direction === 'RIGHT') head.x += gridSize;

    snake.unshift(head);

    // Eat food
    if(head.x === food.x && head.y === food.y) {
        score += 10;
        scoreEl.textContent = score;
        eatSound.play();
        spawnFood();
    } else {
        snake.pop();
    }
}

// Draw snake
function drawSnake() {
    ctx.fillStyle = snakeColor;
    snake.forEach((segment) => {
        ctx.beginPath();
        ctx.arc(segment.x + gridSize/2, segment.y + gridSize/2, gridSize/2 - 2, 0, Math.PI*2);
        ctx.fill();
    });
}

// Spawn food ensuring it doesn't spawn on the snake
function spawnFood() {
    let validPosition = false;
    while (!validPosition) {
        food = {
            x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
            y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize
        };
        validPosition = !snake.some(segment => segment.x === food.x && segment.y === food.y);
    }
}

// Draw food (apple)
function drawFood() {
    ctx.drawImage(appleImg, food.x, food.y, gridSize, gridSize);
}

// Check collisions
function checkCollision() {
    const head = snake[0];
    // Wall collision
    if(head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
        gameOver();
    }
    // Self collision
    for(let i = 1; i < snake.length; i++) {
        if(head.x === snake[i].x && head.y === snake[i].y) {
            gameOver();
        }
    }
}

// Game Over
function gameOver() {
    clearInterval(gameInterval);
    isPaused = true;
    pauseBtn.disabled = true;
    gameInitialized = false;
    gameOverSound.play();
    if(score > highScore) highScore = score;
    highScoreEl.textContent = highScore;
    showPopup('Better Luck Next Time!', 1500);
}

// Popup with animation
function showPopup(text, duration, callback) {
    const popup = document.createElement('div');
    popup.classList.add('popup');
    popup.textContent = text;
    document.getElementById('gameContainer').appendChild(popup);
    setTimeout(() => {
        popup.remove();
        if(callback) callback();
    }, duration);
}

// Toggle pause/resume
function togglePause() {
    if (!gameInitialized) return; // Do nothing if game not initialized

    if (isPaused) {
        startGameLoop();
    } else {
        clearInterval(gameInterval);
        showPopup('Paused', 800);
        pauseBtn.textContent = 'Resume';
        isPaused = true;
    }
}
</script>
</body>
</html>
